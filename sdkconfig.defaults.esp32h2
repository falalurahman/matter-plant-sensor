# ESP32-H2: Matter over Thread

# Disable WiFi (H2 has no WiFi radio)
# CONFIG_ESP_WIFI_ENABLED is not set
# CONFIG_ENABLE_WIFI_STATION is not set
# CONFIG_ENABLE_WIFI_AP is not set
# CONFIG_USE_BLE_ONLY_FOR_COMMISSIONING is not set

# Enable OpenThread
CONFIG_OPENTHREAD_ENABLED=y
CONFIG_OPENTHREAD_SRP_CLIENT=y
CONFIG_OPENTHREAD_DNS_CLIENT=y
# CONFIG_OPENTHREAD_LOG_LEVEL_DYNAMIC is not set
CONFIG_OPENTHREAD_LOG_LEVEL_NOTE=y
# CONFIG_OPENTHREAD_CLI is not set

# LwIP for Thread
# CONFIG_LWIP_IPV6_AUTOCONFIG is not set
CONFIG_LWIP_IPV6_NUM_ADDRESSES=8
CONFIG_LWIP_MULTICAST_PING=y

# Use platform mDNS for Thread (not minimal)
# CONFIG_USE_MINIMAL_MDNS is not set

# MRP configs for Thread
CONFIG_MRP_LOCAL_ACTIVE_RETRY_INTERVAL_FOR_THREAD=5000
CONFIG_MRP_LOCAL_IDLE_RETRY_INTERVAL_FOR_THREAD=5000
CONFIG_MRP_RETRY_INTERVAL_SENDER_BOOST_FOR_THREAD=5000
CONFIG_MRP_MAX_RETRANS=3

# Subscription persistence: device proactively re-establishes subscriptions
# after deep sleep wakeup instead of waiting for controllers to re-subscribe.
# Maps to CHIP_CONFIG_PERSIST_SUBSCRIPTIONS + CHIP_CONFIG_SUBSCRIPTION_TIMEOUT_RESUMPTION.
CONFIG_ENABLE_PERSIST_SUBSCRIPTIONS=y

# ICD (Long Idle Time) â€” SED that sleeps for hours
# LIT + CIP required so controllers (Apple Home) don't mark device offline.
# IMPORTANT: CONFIG_ICD_IDLE_MODE_INTERVAL_SEC must match ICD_WAKE_INTERVAL_S
# in platformio.ini. If they diverge, Apple Home sets subscription MaxInterval
# from the advertised value and the subscription expires (~18 min with 900s
# default), causing "no active subscriptions" on wake. Testing=120s, prod=3600s.
CONFIG_ENABLE_ICD_SERVER=y
CONFIG_ENABLE_ICD_LIT=y
CONFIG_ENABLE_ICD_CIP=y
CONFIG_ICD_IDLE_MODE_INTERVAL_SEC=120
CONFIG_ICD_ACTIVE_MODE_INTERVAL_MS=10000
CONFIG_ICD_ACTIVE_MODE_THRESHOLD_MS=5000
CONFIG_ICD_SLOW_POLL_INTERVAL_MS=1000
CONFIG_ICD_FAST_POLL_INTERVAL_MS=200
CONFIG_ICD_REPORT_ON_ACTIVE_MODE=y

# Radio sleep (reduces current draw during active periods and any light-sleep phases)
CONFIG_IEEE802154_SLEEP_ENABLE=y
CONFIG_BT_LE_SLEEP_ENABLE=y

# Flash power-down and peripheral power-down during sleep
CONFIG_ESP_SLEEP_POWER_DOWN_FLASH=y
CONFIG_PM_ENABLE=y
CONFIG_PM_DFS_INIT_AUTO=y
CONFIG_PM_POWER_DOWN_PERIPHERAL_IN_LIGHT_SLEEP=y